<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Valorant Routine Tracker</title>

  <!-- Tipograf√≠a semi-pro -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #07090f;
      --panel: #0b0f1a;
      --panel2:#0e1424;
      --border:#1b2440;
      --text:#e7ecff;
      --muted:#9aa4c7;
      --red:#ff4655;
      --blue:#1f3b7a;
      --good:#3cff88;
      --bad:#ff7a7a;
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --radius: 16px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(31,59,122,.25), transparent 60%),
                  radial-gradient(900px 700px at 80% 20%, rgba(255,70,85,.18), transparent 55%),
                  var(--bg);
      color: var(--text);
    }
    .wrap{ max-width: 1200px; margin: 28px auto; padding: 0 18px 36px; }
    .topbar{ display:flex; align-items:flex-end; justify-content:space-between; gap:16px; margin-bottom: 18px; }
    h1{ margin:0; font-size: 28px; letter-spacing: .2px; }
    .subtitle{ margin-top:6px; color: var(--muted); font-size: 14px; }
    .badge{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,70,85,.14), rgba(31,59,122,.10));
      padding: 10px 12px; border-radius: 999px;
      color: var(--text); font-weight: 700; font-size: 13px;
      box-shadow: var(--shadow);
      white-space:nowrap;
    }

    .grid{ display:grid; grid-template-columns: 1fr 1.35fr; gap: 16px; align-items:start; }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
    }
    .card h2{ margin: 0 0 10px; font-size: 18px; letter-spacing: .2px; }

    label{ display:block; margin-top: 10px; color: var(--muted); font-size: 13px; font-weight: 700; }
    input, select{
      width:100%; margin-top: 6px; padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(11,15,26,.85);
      color: var(--text);
      outline:none;
      font-size: 15px;
    }
    input::placeholder{ color: rgba(154,164,199,.6); }

    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .row > *{ flex:1; min-width: 160px; }

    .btns{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 14px; }
    button{
      cursor:pointer;
      border-radius: 12px;
      padding: 11px 14px;
      font-weight: 800;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      color: var(--text);
      font-size: 14px;
    }
    button.primary{
      border-color: rgba(255,70,85,.55);
      background: linear-gradient(180deg, rgba(255,70,85,.25), rgba(255,70,85,.10));
    }
    button.danger{
      border-color: rgba(255,122,122,.5);
      background: rgba(255,122,122,.10);
    }

    .kpis{ display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .kpi{
      border-radius: 14px;
      border:1px solid var(--border);
      background: rgba(11,15,26,.75);
      padding: 12px;
    }
    .kpi .t{ color: var(--muted); font-size: 12px; font-weight: 800; }
    .kpi .v{ font-size: 22px; font-weight: 900; margin-top: 6px; }
    .kpi .s{ color: var(--muted); font-size: 12px; margin-top: 3px; }

    .divider{ height:1px; background: rgba(27,36,64,.7); margin: 14px 0; }

    .weekProgress{ display:grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-top: 10px; }
    .dayBox{
      border:1px solid var(--border);
      border-radius: 12px;
      padding: 10px 10px;
      background: rgba(11,15,26,.6);
      text-align:center;
      font-weight: 900;
      font-size: 12px;
    }
    .dayBox span{ display:block; margin-top: 6px; font-size: 12px; font-weight: 800; color: var(--muted); }
    .done{ border-color: rgba(60,255,136,.35); background: rgba(60,255,136,.10); }
    .miss{ border-color: rgba(255,70,85,.25); background: rgba(255,70,85,.06); }

    table{ width:100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; border-radius: 14px; overflow:hidden; }
    th, td{ padding: 10px 10px; border-bottom: 1px solid rgba(27,36,64,.7); text-align:left; vertical-align: top; }
    th{ color: var(--muted); font-size: 12px; font-weight: 900; letter-spacing:.2px; }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid var(--border);
      background: rgba(11,15,26,.7);
      color: var(--text);
      font-size: 12px;
      font-weight: 800;
    }
    .dot{ width:8px; height:8px; border-radius: 999px; background: var(--red); }
    .dot.blue{ background: #6ea8ff; }
    .dot.good{ background: var(--good); }
    .dot.bad{ background: var(--bad); }
    .muted{ color: var(--muted); font-size: 13px; }
    .rightTop{ display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .kpis{ grid-template-columns: 1fr; }
      .badge{ display:none; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <h1>Valorant Routine Tracker ‚Äî Dashboard</h1>
        <div class="subtitle">5 tiempos de bots + Hard bots + 5 Deathmatch. Semana/Mes, mejor/peor d√≠a, progreso por d√≠as.</div>
      </div>
      <div class="badge">üîª Dark Mode ¬∑ VLR Style</div>
    </div>

    <div class="grid">
      <!-- FORM -->
      <div class="card">
        <h2>Nuevo registro</h2>

        <label>Fecha</label>
        <input id="date" type="date" />

        <label>100 Bots ‚Äî 5 tiempos (seg)</label>
        <div class="row">
          <div><input id="botT1" type="number" min="0" step="0.1" placeholder="T1 (ej: 62.5)" /></div>
          <div><input id="botT2" type="number" min="0" step="0.1" placeholder="T2 (ej: 61.8)" /></div>
          <div><input id="botT3" type="number" min="0" step="0.1" placeholder="T3 (ej: 63.1)" /></div>
          <div><input id="botT4" type="number" min="0" step="0.1" placeholder="T4 (ej: 60.9)" /></div>
          <div><input id="botT5" type="number" min="0" step="0.1" placeholder="T5 (ej: 62.0)" /></div>
        </div>
        <div class="muted" style="margin-top:6px;">Se calcula el promedio (avg) y el mejor tiempo (best = m√°s bajo).</div>

        <div class="row">
          <div>
            <label>Bots en Hard (15 repeticiones)</label>
            <input id="hardBots" type="number" min="0" step="1" placeholder="Ej: 430" />
            <div class="muted" style="margin-top:6px;">Total de bots destruidos en 15 reps.</div>
          </div>
        </div>

        <div class="divider"></div>

        <h2 style="margin-top:0;">Deathmatch (5 resultados)</h2>
        <div class="row">
          <div>
            <label>Kills totales (en 5 DMs)</label>
            <input id="dmKills" type="number" min="0" step="1" placeholder="Ej: 112" />
          </div>
          <div>
            <label>Deaths totales (en 5 DMs)</label>
            <input id="dmDeaths" type="number" min="0" step="1" placeholder="Ej: 86" />
          </div>
        </div>

        <label>Notas (opcional)</label>
        <input id="notes" type="text" placeholder="Ej: Vandal only / Sheriff / foco en strafe" />

        <div class="btns">
          <button class="primary" id="addBtn">Guardar</button>
          <button class="danger" id="clearBtn">Borrar todo</button>
          <button id="exportBtn">Exportar CSV</button>
        </div>

        <div class="muted" style="margin-top:12px;">
          Tip: ‚Äúscore del d√≠a‚Äù = <b>HardBots + (K/D √ó 10) ‚àí (AvgBots/10)</b>. Eso decide mejor/peor d√≠a.
        </div>
      </div>

      <!-- DASHBOARD -->
      <div>
        <div class="card">
          <div class="rightTop">
            <h2 style="margin:0;">Resumen</h2>
            <div class="row" style="margin:0; gap:10px;">
              <div style="min-width:220px; flex:1;">
                <label style="margin-top:0;">Vista</label>
                <select id="viewMode">
                  <option value="week">Semana</option>
                  <option value="month">Mes</option>
                  <option value="all">Todo</option>
                </select>
              </div>
              <div style="min-width:220px; flex:1;">
                <label style="margin-top:0;">Per√≠odo</label>
                <select id="periodSelect"></select>
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="kpis">
            <div class="kpi">
              <div class="t">Bots (avg)</div>
              <div class="v" id="kpiBotAvg">‚Äî</div>
              <div class="s">Segundos (menor = mejor)</div>
            </div>
            <div class="kpi">
              <div class="t">Bots (best)</div>
              <div class="v" id="kpiBotBest">‚Äî</div>
              <div class="s">Mejor tiempo hist√≥rico/per√≠odo</div>
            </div>
            <div class="kpi">
              <div class="t">Hard bots (promedio)</div>
              <div class="v" id="kpiHardBots">‚Äî</div>
              <div class="s">Total/15 reps (mayor = mejor)</div>
            </div>

            <div class="kpi">
              <div class="t">K/D Deathmatch (promedio)</div>
              <div class="v" id="kpiKD">‚Äî</div>
              <div class="s">Mayor = mejor</div>
            </div>
            <div class="kpi">
              <div class="t">Kills DM (promedio)</div>
              <div class="v" id="kpiKills">‚Äî</div>
              <div class="s">Kills del d√≠a</div>
            </div>
            <div class="kpi">
              <div class="t">Registros</div>
              <div class="v" id="kpiCount">0</div>
              <div class="s" id="kpiLast">√öltimo: ‚Äî</div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="row">
            <span class="pill"><span class="dot good"></span> Mejor d√≠a: <b id="bestDay">‚Äî</b></span>
            <span class="pill"><span class="dot bad"></span> Peor d√≠a: <b id="worstDay">‚Äî</b></span>
            <span class="pill"><span class="dot blue"></span> Promedio score: <b id="avgScore">‚Äî</b></span>
          </div>

          <div class="divider"></div>

          <h2 style="margin:0 0 8px;">Progreso (d√≠as de la semana)</h2>
          <div class="muted">Se marca si registraste algo ese d√≠a dentro del per√≠odo seleccionado.</div>
          <div class="weekProgress" id="weekProgress"></div>
        </div>

        <div class="card" style="margin-top:16px;">
          <h2 style="margin:0;">Historial</h2>
          <div class="muted" id="countInfo" style="margin-top:6px;">0 registro(s)</div>

          <table>
            <thead>
              <tr>
                <th>Fecha</th>
                <th>D√≠a</th>
                <th>Bots avg/best</th>
                <th>Hard bots (15)</th>
                <th>DM K</th>
                <th>DM D</th>
                <th>K/D</th>
                <th>Score</th>
                <th>Notas</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

<script>
  const KEY = "valorant_routine_tracker_v4";

  const el = (id) => document.getElementById(id);

  const DOW_SHORT = ["Dom","Lun","Mar","Mi√©","Jue","Vie","S√°b"];
  const DOW_MON_FIRST = ["Lun","Mar","Mi√©","Jue","Vie","S√°b","Dom"];

  function load(){
    try { return JSON.parse(localStorage.getItem(KEY)) ?? []; }
    catch { return []; }
  }
  function save(items){
    localStorage.setItem(KEY, JSON.stringify(items));
  }

  function safeNum(v){
    const n = Number(v);
    return Number.isFinite(n) ? n : 0;
  }

  function kd(k, d){
    if (d === 0) return k === 0 ? 0 : k;
    return k / d;
  }

  function mean(arr){
    if (!arr.length) return 0;
    return arr.reduce((a,b)=>a+b,0) / arr.length;
  }

  function fmt(n, d=2){
    const p = Math.pow(10,d);
    return (Math.round(n*p)/p).toFixed(d);
  }

  function dowName(dateStr){
    const d = new Date(dateStr + "T00:00:00");
    return DOW_SHORT[d.getDay()];
  }

  function avgBotTime(item){
    const arr = Array.isArray(item.botTimes) ? item.botTimes : [];
    const vals = arr.map(n => Number(n)).filter(n => Number.isFinite(n) && n > 0);
    if (!vals.length) return 0;
    return mean(vals);
  }
  function bestBotTime(item){
    const arr = Array.isArray(item.botTimes) ? item.botTimes : [];
    const vals = arr.map(n => Number(n)).filter(n => Number.isFinite(n) && n > 0);
    if (!vals.length) return 0;
    return Math.min(...vals);
  }

  // Score compuesto: hardBots alto + KD alto + botsAvg bajo
  function perfScore(item){
    const botAvg = avgBotTime(item);
    const hardBots = item.hardBots || 0;
    const kdr = kd(item.dmKills||0, item.dmDeaths||0);
    return (hardBots) + (kdr * 10) - (botAvg / 10);
  }

  // ISO week key (lunes inicio)
  function isoWeekKey(dateStr){
    const d = new Date(dateStr + "T00:00:00");
    const day = (d.getDay() + 6) % 7; // Mon=0..Sun=6
    d.setDate(d.getDate() - day + 3);
    const firstThursday = new Date(d.getFullYear(), 0, 4);
    const firstDay = (firstThursday.getDay() + 6) % 7;
    firstThursday.setDate(firstThursday.getDate() - firstDay + 3);
    const weekNumber = 1 + Math.round((d - firstThursday) / (7 * 24 * 3600 * 1000));
    const year = d.getFullYear();
    return `${year}-W${String(weekNumber).padStart(2,'0')}`;
  }

  function monthKey(dateStr){
    const d = new Date(dateStr + "T00:00:00");
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    return `${y}-${m}`;
  }

  function periodKeyByMode(mode, dateStr){
    if (mode === "week") return isoWeekKey(dateStr);
    if (mode === "month") return monthKey(dateStr);
    return "all";
  }

  function uniquePeriods(mode){
    const items = load().filter(x => x.date);
    if (mode === "all") return ["all"];
    const set = new Set(items.map(x => periodKeyByMode(mode, x.date)));
    return Array.from(set).sort((a,b)=> b.localeCompare(a));
  }

  function renderPeriodSelect(){
    const mode = el("viewMode").value;
    const periods = uniquePeriods(mode);
    const ps = el("periodSelect");
    ps.innerHTML = "";
    for (const p of periods){
      const opt = document.createElement("option");
      opt.value = p;
      opt.textContent = (mode === "all") ? "Todo" : p;
      ps.appendChild(opt);
    }
    ps.value = periods[0] ?? (mode === "all" ? "all" : "");
  }

  function bestWorst(items){
    if (!items.length) return { best:null, worst:null, avgScore:0 };
    let best = items[0], worst = items[0];
    const scores = [];
    for (const it of items){
      const s = perfScore(it);
      scores.push(s);
      if (s > perfScore(best)) best = it;
      if (s < perfScore(worst)) worst = it;
    }
    return { best, worst, avgScore: mean(scores) };
  }

  function renderWeekProgress(items){
    const box = el("weekProgress");
    box.innerHTML = "";

    const has = new Set();
    for (const it of items){
      const d = new Date(it.date + "T00:00:00");
      const dowMonFirst = (d.getDay() + 6) % 7; // Mon=0..Sun=6
      has.add(dowMonFirst);
    }

    for (let i=0;i<7;i++){
      const div = document.createElement("div");
      div.className = "dayBox " + (has.has(i) ? "done" : "miss");
      div.innerHTML = `${DOW_MON_FIRST[i]}<span>${has.has(i) ? "Hecho" : "‚Äî"}</span>`;
      box.appendChild(div);
    }
  }

  function render(){
    const mode = el("viewMode").value;
    const period = el("periodSelect").value || (mode === "all" ? "all" : "");

    const allItems = load().slice().sort((a,b)=> (a.date||"").localeCompare(b.date||""));
    const items = (mode === "all") ? allItems : allItems.filter(x => periodKeyByMode(mode, x.date) === period);

    el("countInfo").textContent = `${items.length} registro(s)`;
    el("kpiCount").textContent = String(items.length);

    const last = allItems.length ? allItems[allItems.length-1].date : "‚Äî";
    el("kpiLast").textContent = `√öltimo: ${last}`;

    // KPIs
    const botAvgs = items.map(x => avgBotTime(x)).filter(x => x > 0);
    const botBests = items.map(x => bestBotTime(x)).filter(x => x > 0);

    const hardBots = items.map(x => x.hardBots || 0);
    const dmKills = items.map(x => x.dmKills || 0);
    const dmDeaths = items.map(x => x.dmDeaths || 0);
    const kds = items.map(x => kd(x.dmKills||0, x.dmDeaths||0));

    el("kpiBotAvg").textContent = botAvgs.length ? `${fmt(mean(botAvgs),1)}s` : "‚Äî";
    el("kpiBotBest").textContent = botBests.length ? `${fmt(Math.min(...botBests),1)}s` : "‚Äî";
    el("kpiHardBots").textContent = items.length ? fmt(mean(hardBots),0) : "‚Äî";
    el("kpiKD").textContent = items.length ? fmt(mean(kds),2) : "‚Äî";
    el("kpiKills").textContent = items.length ? fmt(mean(dmKills),0) : "‚Äî";

    const bw = bestWorst(items);
    el("bestDay").textContent = bw.best ? `${bw.best.date} (${dowName(bw.best.date)})` : "‚Äî";
    el("worstDay").textContent = bw.worst ? `${bw.worst.date} (${dowName(bw.worst.date)})` : "‚Äî";
    el("avgScore").textContent = items.length ? fmt(bw.avgScore,1) : "‚Äî";

    renderWeekProgress(items);

    // tabla
    const tbody = el("tbody");
    tbody.innerHTML = "";
    for (const x of items.slice().sort((a,b)=> (b.date||"").localeCompare(a.date||""))){
      const kdr = kd(x.dmKills||0, x.dmDeaths||0);
      const score = perfScore(x);
      const avgT = avgBotTime(x);
      const bestT = bestBotTime(x);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${x.date || ""}</td>
        <td>${x.date ? dowName(x.date) : ""}</td>
        <td>${avgT ? (fmt(avgT,1) + "s / " + fmt(bestT,1) + "s") : "‚Äî"}</td>
        <td>${fmt(x.hardBots||0,0)}</td>
        <td>${fmt(x.dmKills||0,0)}</td>
        <td>${fmt(x.dmDeaths||0,0)}</td>
        <td>${fmt(kdr,2)}</td>
        <td>${fmt(score,1)}</td>
        <td>${(x.notes||"").replaceAll("<","&lt;").replaceAll(">","&gt;")}</td>
        <td><button data-id="${x.id}">Eliminar</button></td>
      `;
      tr.querySelector("button").addEventListener("click", () => {
        const updated = load().filter(i => i.id !== x.id);
        save(updated);
        renderPeriodSelect();
        render();
      });
      tbody.appendChild(tr);
    }
  }

  function addItem(){
    const date = el("date").value || new Date().toISOString().slice(0,10);

    const botTimes = [
      Math.max(0, safeNum(el("botT1").value)),
      Math.max(0, safeNum(el("botT2").value)),
      Math.max(0, safeNum(el("botT3").value)),
      Math.max(0, safeNum(el("botT4").value)),
      Math.max(0, safeNum(el("botT5").value)),
    ];

    const hardBots = Math.max(0, Math.floor(safeNum(el("hardBots").value)));
    const dmKills = Math.max(0, Math.floor(safeNum(el("dmKills").value)));
    const dmDeaths = Math.max(0, Math.floor(safeNum(el("dmDeaths").value)));
    const notes = (el("notes").value || "").trim();

    const item = { id: crypto.randomUUID(), date, botTimes, hardBots, dmKills, dmDeaths, notes };

    const items = load();
    items.push(item);
    save(items);

    // limpiar inputs (conservar fecha)
    el("botT1").value = "";
    el("botT2").value = "";
    el("botT3").value = "";
    el("botT4").value = "";
    el("botT5").value = "";
    el("hardBots").value = "";
    el("dmKills").value = "";
    el("dmDeaths").value = "";
    el("notes").value = "";

    renderPeriodSelect();
    render();
  }

  function clearAll(){
    const ok = confirm("¬øSeguro que quieres borrar todo? Esto no se puede deshacer.");
    if (!ok) return;
    localStorage.removeItem(KEY);
    renderPeriodSelect();
    render();
  }

  function exportCSV(){
    const items = load();
    const header = ["date","dow","botT1","botT2","botT3","botT4","botT5","botAvg","botBest","hardBots15reps","dmKillsTotal5","dmDeathsTotal5","dmKD","score","notes"];

    const rows = items.map(x => {
      const bt = Array.isArray(x.botTimes) ? x.botTimes : [0,0,0,0,0];
      const kdr = kd(x.dmKills||0, x.dmDeaths||0);
      const s = perfScore(x);
      const botAvg = avgBotTime(x);
      const botBest = bestBotTime(x);

      return [
        x.date,
        x.date ? dowName(x.date) : "",
        bt[0]||0, bt[1]||0, bt[2]||0, bt[3]||0, bt[4]||0,
        botAvg.toFixed(2),
        botBest.toFixed(2),
        x.hardBots || 0,
        x.dmKills || 0,
        x.dmDeaths || 0,
        kdr.toFixed(4),
        s.toFixed(2),
        (x.notes ?? "").replaceAll('"','""')
      ];
    });

    const csv = [header, ...rows]
      .map(r => r.map(v => `"${String(v)}"`).join(","))
      .join("\n");

    const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "valorant_routine_tracker.csv";
    a.click();
    URL.revokeObjectURL(url);
  }

  // eventos
  el("addBtn").addEventListener("click", addItem);
  el("clearBtn").addEventListener("click", clearAll);
  el("exportBtn").addEventListener("click", exportCSV);

  el("viewMode").addEventListener("change", () => {
    renderPeriodSelect();
    render();
  });
  el("periodSelect").addEventListener("change", () => render());

  // init
  el("date").value = new Date().toISOString().slice(0,10);
  renderPeriodSelect();
  render();
</script>
</body>
</html>
